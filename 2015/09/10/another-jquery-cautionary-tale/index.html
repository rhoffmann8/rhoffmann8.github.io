<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="One second, I need to compose myself. There are plenty of warnings out there that reliance on undocumented behavior is dangerous and could potentially break your app. Of course, there are many more de">
<meta property="og:type" content="article">
<meta property="og:title" content="A jQuery .text() cautionary tale">
<meta property="og:url" content="https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/index.html">
<meta property="og:site_name" content="Rob Hoffmann">
<meta property="og:description" content="One second, I need to compose myself. There are plenty of warnings out there that reliance on undocumented behavior is dangerous and could potentially break your app. Of course, there are many more de">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2015-09-10T04:00:00.000Z">
<meta property="article:modified_time" content="2020-05-24T04:28:03.930Z">
<meta property="article:author" content="Rob Hoffmann">
<meta name="twitter:card" content="summary">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>A jQuery .text() cautionary tale</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 4.2.1"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2016/01/01/new-year-new-site/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2015/08/04/dont-forget-content-type/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/" target="_blank" rel="noopener"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/&text=A jQuery .text() cautionary tale" target="_blank" rel="noopener"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/&title=A jQuery .text() cautionary tale" target="_blank" rel="noopener"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/&is_video=false&description=A jQuery .text() cautionary tale" target="_blank" rel="noopener"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=A jQuery .text() cautionary tale&body=Check out this article: https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/&title=A jQuery .text() cautionary tale" target="_blank" rel="noopener"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/&title=A jQuery .text() cautionary tale" target="_blank" rel="noopener"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/&title=A jQuery .text() cautionary tale" target="_blank" rel="noopener"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/&title=A jQuery .text() cautionary tale" target="_blank" rel="noopener"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/&name=A jQuery .text() cautionary tale&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/&t=A jQuery .text() cautionary tale" target="_blank" rel="noopener"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        A jQuery .text() cautionary tale
    </h1>



    <div class="meta">
      
    <div class="postdate">
      
        <time datetime="2015-09-10T04:00:00.000Z" itemprop="datePublished">10 Sep 2015</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><a href="http://espn.go.com/blog/new-york/mets/post/_/id/110476/mets-sweep-nationals-in-catbird-seat-in-nl-east-race" target="_blank" rel="noopener">One second, I need to compose myself.</a></p>
<p>There are plenty of warnings out there that reliance on undocumented behavior is dangerous and could potentially break your app. Of course, there are many more developers out there that will still manage to sneak in a hack every now and then that will take advantage of some quirk which may or may not come back to haunt them later. The latest one of these I found had to do with jQueryâ€™s <code>.text()</code> function and its behavior across versions.</p>
<p>While refactoring a portion of our site we upgraded from jQuery 1.6.4 to 1.11.0. During QA it was reported that there was some random vertical spacing appearing between some text that was not there prior to the upgrade.</p>
<p><em>Great, one of these.</em> I opened up my dev tools to see what was going on.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error"</span>&gt;</span>Date of Birth<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> <span class="comment">&lt;!-- what? --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error"</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error"</span>&gt;</span>Email Confirmation<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error"</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Without changing any script related to error message construction, a blank div appeared out of the nether that wasnâ€™t there before. I dug deeper into the third-party script we fetched server-side that dealt with these messages and found the relevant code:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> field <span class="keyword">in</span> cfg.errorFields) &#123;</span><br><span class="line">  <span class="keyword">if</span> ((field === <span class="string">"month"</span> || field === <span class="string">"day"</span> || field === <span class="string">"year"</span>) &amp;&amp; !dobAdded) &#123;</span><br><span class="line">    innerShell.append($(<span class="string">"&lt;div class=\"error\"&gt;"</span>).text(self._blankMessages[<span class="string">"dateOfBirth"</span>]));</span><br><span class="line">    dobAdded = <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    innerShell.append($(<span class="string">"&lt;div class=\"error\"&gt;"</span>).text(self._blankMessages[field]));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So if any one of the <code>month</code>, <code>day</code>, or <code>year</code> fields were blank, the code would show an error message for the date of birth field. On a subsequent iteration, if it caught another blank instance of those three fields, it defaulted to appending an empty error div and assigning a default message for that particular field.</p>
<p>However, month, day, and year were not indices of <code>self._blankMessages</code>, so the argument defaulted to <code>undefined</code>. On the old page, the result was no div being constructed. Why did it start appearing after the upgrade?</p>
<p>My suspicions were confirmed after running the same code on a test page with two different jQ libraries:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; jQuery.fn.jquery</span><br><span class="line"><span class="string">"1.6.4"</span></span><br><span class="line">&gt; $(<span class="string">'&lt;div class="error"&gt;'</span>).text(undefined)</span><br><span class="line"><span class="string">""</span></span><br><span class="line">&gt; jQuery.fn.jquery</span><br><span class="line"><span class="string">"1.11.0"</span></span><br><span class="line">&gt; $(<span class="string">'&lt;div class="error"&gt;'</span>).text(undefined)</span><br><span class="line">[ &lt;div class=<span class="string">"error"</span>&gt;&lt;/div&gt; ]</span><br></pre></td></tr></table></figure>

<p>The same method returned a different value for each version of jQuery. Letâ€™s take a closer look at the source code:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jQuery 1.6.4</span></span><br><span class="line">jQuery.fn.extend(&#123;</span><br><span class="line">  text: <span class="function"><span class="keyword">function</span>(<span class="params"> text </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( jQuery.isFunction(text) ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self = jQuery( <span class="keyword">this</span> );</span><br><span class="line">        self.text( text.call(<span class="keyword">this</span>, i, self.text()) );</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">typeof</span> text !== <span class="string">"object"</span> &amp;&amp; text !== <span class="literal">undefined</span> ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.empty().append( (<span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; <span class="keyword">this</span>[<span class="number">0</span>].ownerDocument || <span class="built_in">document</span>).createTextNode( text ) );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> jQuery.text( <span class="keyword">this</span> ); <span class="comment">// In our case "text" is undefined, so getter function</span></span><br><span class="line">                                <span class="comment">// is triggered which will return a blank string</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// jQuery 1.11.0</span></span><br><span class="line">jQuery.fn.extend(&#123;</span><br><span class="line">  text: <span class="function"><span class="keyword">function</span>(<span class="params"> value </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> access( <span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> value </span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> value === <span class="literal">undefined</span> ?</span><br><span class="line">        jQuery.text( <span class="keyword">this</span> ) :</span><br><span class="line">        <span class="keyword">this</span>.empty().append( ( <span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; <span class="keyword">this</span>[<span class="number">0</span>].ownerDocument || <span class="built_in">document</span> ).createTextNode( value ) );</span><br><span class="line">    &#125;, <span class="literal">null</span>, value, <span class="built_in">arguments</span>.length );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Both versions check if the value is defined in order to determine if it should invoke getter or setter behavior. However 1.11.0 makes use of a separate function called <code>access</code> to do this. This function appeared sometime between 1.6.4 and 1.7.2.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> access = jQuery.access = <span class="function"><span class="keyword">function</span>(<span class="params"> elems, fn, key, value, chainable, emptyGet, raw </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span>,</span><br><span class="line">    length = elems.length,</span><br><span class="line">    bulk = key == <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// Sets many values</span></span><br><span class="line">  <span class="keyword">if</span> ( jQuery.type( key ) === <span class="string">"object"</span> ) &#123;</span><br><span class="line">    chainable = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> ( i <span class="keyword">in</span> key ) &#123;</span><br><span class="line">      jQuery.access( elems, fn, i, key[i], <span class="literal">true</span>, emptyGet, raw );</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">// Sets one value</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( value !== <span class="literal">undefined</span> ) &#123;</span><br><span class="line">    chainable = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !jQuery.isFunction( value ) ) &#123;</span><br><span class="line">      raw = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( bulk ) &#123;</span><br><span class="line">      <span class="comment">// Bulk operations run against the entire set</span></span><br><span class="line">      <span class="keyword">if</span> ( raw ) &#123;</span><br><span class="line">        fn.call( elems, value );</span><br><span class="line">        fn = <span class="literal">null</span>;</span><br><span class="line">      <span class="comment">// ...except when executing function values</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        bulk = fn;</span><br><span class="line">        fn = <span class="function"><span class="keyword">function</span>(<span class="params"> elem, key, value </span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> bulk.call( jQuery( elem ), value );</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( fn ) &#123;</span><br><span class="line">      <span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;</span><br><span class="line">        fn( elems[i], key, raw ? value : value.call( elems[i], i, fn( elems[i], key ) ) );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> chainable ?</span><br><span class="line">    elems :</span><br><span class="line">    <span class="comment">// Gets</span></span><br><span class="line">    bulk ?</span><br><span class="line">      fn.call( elems ) :</span><br><span class="line">      length ? fn( elems[<span class="number">0</span>], key ) : emptyGet;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>So whatâ€™s changed? In 1.6.4 an undefined argument triggered the getter functionality of .text(), which was actually an issue of some debate years ago. With the addition of the access function however, a new condition chainable was introduced. In a typical getter invocation, .text() will call access as follows:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> access( <span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> value </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> value === <span class="literal">undefined</span> ?</span><br><span class="line">    jQuery.text( <span class="keyword">this</span> ) :</span><br><span class="line">    <span class="keyword">this</span>.empty().append( ( <span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; <span class="keyword">this</span>[<span class="number">0</span>].ownerDocument || <span class="built_in">document</span> ).createTextNode( value ) );</span><br><span class="line">&#125;, <span class="literal">null</span>, value, <span class="built_in">arguments</span>.length ); <span class="comment">// value = undefined, arguments.length = 0</span></span><br></pre></td></tr></table></figure>

<p>Since <code>arguments.length</code> is 0, chainable would evaluate to false and the callback provided from text, which switches on <code>return value === undefined</code> and runs <code>jQuery.text( this )</code>, would be invoked via <code>fn.call( elems )</code>.</p>
<p>According to the issue above, passing <code>.text(undefined)</code> should invoke the getter as well â€“ except we never get there. Since passing actual undefined results in <code>arguments.length</code> evaluating to 1, even though value is the same in both scenarios the callback function is never invoked! Instead, elems is returned rather than the blank string from the result of <code>jQuery.text</code>, so that was why the blank div was being generated in the new site.</p>
<p>Iâ€™m not sure if this modified behavior was an intended side effect of jQueryâ€™s access function, but there is a more important lesson here. The code should have been more explicit in handling this kind of scenario, especially since the fix is very simple:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> field <span class="keyword">in</span> cfg.errorFields) &#123;</span><br><span class="line">  <span class="keyword">if</span> (field === <span class="string">"month"</span> || field === <span class="string">"day"</span> || field === <span class="string">"year"</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!dobAdded) &#123;</span><br><span class="line">      innerShell.append($(<span class="string">"&lt;div class=\"error\"&gt;"</span>).text(self._blankMessages[<span class="string">"dateOfBirth"</span>]));</span><br><span class="line">      dobAdded = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    innerShell.append($(<span class="string">"&lt;div class=\"error\"&gt;"</span>).text(self._blankMessages[field]));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Problem solved. Instead of defaulting to the <code>else</code> case when another DOB field is encountered, simply skip adding a DOB error div if we already did so. Relying on a side-effect of passing undefined is never a good idea, and it will eventually create a headache for your coworkers.</p>
<p>I understand this kind of stuff happens â€” after all, deadlines exist â€” but I hope this will remind you (it certainly did for me) to stop and think for a second next time youâ€™re in a situation like this and evaluate whether an odd behavior may be subject to change in the future.</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/&text=A jQuery .text() cautionary tale" target="_blank" rel="noopener"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/&title=A jQuery .text() cautionary tale" target="_blank" rel="noopener"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/&is_video=false&description=A jQuery .text() cautionary tale" target="_blank" rel="noopener"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=A jQuery .text() cautionary tale&body=Check out this article: https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/&title=A jQuery .text() cautionary tale" target="_blank" rel="noopener"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/&title=A jQuery .text() cautionary tale" target="_blank" rel="noopener"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/&title=A jQuery .text() cautionary tale" target="_blank" rel="noopener"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/&title=A jQuery .text() cautionary tale" target="_blank" rel="noopener"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/&name=A jQuery .text() cautionary tale&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://robhoffmann.me/2015/09/10/another-jquery-cautionary-tale/&t=A jQuery .text() cautionary tale" target="_blank" rel="noopener"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2015-2020
    Rob Hoffmann
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-64538863-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
